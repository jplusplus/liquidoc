"use strict";angular.module("liquidoc",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.bootstrap","btford.markdown"]),angular.module("liquidoc").service("parser",function(){return{parse:function(e,t,n){return e.replace(/{{(.+)}}/g,function(e,o){var i=_.map(o.split("|"),_.trim);1===i.length&&n&&i.push(n);var a=null,l=null;return _.forEach(i,function(e,n){switch(n){case 0:t&&t.length&&(l=t[0].indexOf(e)+1);break;case 1:a=_.find(t,function(t){return t[0]===e})}}),a&&l?a[l]:null})}}}),angular.module("liquidoc").controller("NavbarCtrl",["$scope",function(e){e.date=new Date}]),angular.module("liquidoc").directive("docViewer",["parser",function(e){return{restrict:"A",templateUrl:"app/components/doc-viewer/doc-viewer.html",scope:{docViewer:"="},link:function(t){t.doc=t.docViewer,t.active=null,t.possibilities=[],t.doc.template=["# Yolo title","## Subtitle","","Lorem markdownum {{ gendergap2005 }} demptos colorem sumere dantem. Nostri Turnus, ad undis virus,","vetitae semicaper ab speciem sopita **honesta** in simul et quot. Splendescunt","omnes, cumque, paravi videres currum, pro adeo monte veteres rege {{ employment2014 }}.","","Vera ipse Proetus partes, ex deducite nomina se fluunt tu venabula neque et","talis auxiliaris pudori arces, exercent. Inmemor iter, in [urbes","donavi](http://www.wedrinkwater.com/): tenuit pater inermis ut inposito est","inquit Cephaloque fervebant."].join("\n"),t.$watch("[doc, active]",function(){var n=(t.doc.dataset||[]).slice(1);t.preview=e.parse(t.doc.template,t.doc.dataset,t.active),t.possibilities=_.map(n,function(e){return e[0]||null})},!0)}}}]),angular.module("liquidoc").directive("docEditor",function(){return{restrict:"A",templateUrl:"app/components/doc-editor/doc-editor.html",scope:{docEditor:"="},link:function(e,t){function n(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t;else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length)}else e.value+=t}e.doc=e.docEditor,e.conditionCollapse=!0,e.doc.template="",e.newCondition={},e.buttons=["test"],e.parseCsv=function(t){var n,o=[];n=t.split("\n");for(var i=0;i<n.length;i++)o.push(n[i].split("	"));e.doc.dataset=o,e.buttons=[];for(var i=1;i<o[0].length;i++){var a=o[0][i];e.buttons.push(a)}console.log(e.doc.dataset)},e.insertVar=function(e){var o=t.find("textarea.form-template");n(o.get(0),"{{"+e+"}}")},e.insertCondition=function(){console.log(e.newCondition);var o=e.newCondition.type?e.newCondition.type:"=",i="IF "+e.newCondition["var"]+" "+o+" "+e.newCondition.value+' THEN "'+e.newCondition.then+'" OTHER "'+e.newCondition.other+'"',a=t.find("textarea.form-template");n(a.get(0),"{{"+i+"}}")}}}}),angular.module("liquidoc").controller("MainCtrl",["$scope",function(e){e.doc={}}]),angular.module("liquidoc").run(["$templateCache",function(e){e.put("app/components/doc-editor/doc-editor.html",'<button class="btn btn-success" ng-init="conditionCollapse = false" ng-click="conditionCollapse = !conditionCollapse"><span class="glyphicon glyphicon-sunglasses"></span> Create condition</button><div class="well" collapse="conditionCollapse"><p><strong>If</strong><select style="display:inline-block;width:100px" class="form-control" ng-model="newCondition.var" ng-options="button for button in buttons"><option value="">Select</option></select><select style="display:inline-block;width:100px" class="form-control" ng-model="newCondition.type"><option value="">equal to</option><option value="<">smaller then</option><option value=">">greater then</option></select><input style="display:inline-block;width:100px" class="form-control" ng-model="newCondition.value"></p><p><strong>Then</strong></p><input class="form-control" ng-model="newCondition.then"><p><strong>Other</strong></p><input class="form-control" ng-model="newCondition.other"> <button class="btn btn-default btn-xs" ng-click="insertCondition()">Add at cursor</button></div><div class="well"><span ng-repeat="button in buttons"><button class="btn btn-default btn-xs" ng-bind="button" ng-click="insertVar(button)"></button></span></div><h3>Your template</h3><textarea ng-model="doc.template" placeholder="Your template here" class="form-control form-template"></textarea><h3>Your dataset</h3><textarea ng-model="dataset" ng-change="parseCsv(dataset)" placeholder="Your dataset here" class="form-control form-csv"></textarea>'),e.put("app/components/doc-viewer/doc-viewer.html",'<select ng-options="value for value in possibilities" ng-model="active"><option value="">Pick a value</option></select><div btf-markdown="preview"></div>'),e.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse" ng-controller="NavbarCtrl"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="https://github.com/jplusplus/liquidoc">Liquidoc</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"></ul></div></div></nav>')}]);