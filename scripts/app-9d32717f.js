"use strict";angular.module("liquidoc",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.bootstrap","btford.markdown"]),angular.module("liquidoc").service("parser",["$rootScope","$parse",function(t,n){var e=/{{(.*?)}}/g,o=/(if)\s+(.+)\s+(then)\s+(.+)\s+(else)\s+(.+)/im;return{parse:function(a,i,l){return a.replace(e,function(e,a){if(i&&i.length){var s=t.$new(!0),c=_.find(i,function(t){return t[0]===l});return o.test(a)&&(a=a.replace(o,"$2 ? $4 : $6")),angular.extend(s,_.object(i[0],c)),n(a)(s)}return null})}}}]),angular.module("liquidoc").controller("NavbarCtrl",["$scope",function(t){t.date=new Date}]),angular.module("liquidoc").directive("docViewer",["parser",function(t){return{restrict:"A",templateUrl:"app/components/doc-viewer/doc-viewer.html",scope:{docViewer:"="},link:function(n){n.doc=n.docViewer,n.active=null,n.possibilities=[],n.$watch("[doc, active]",function(){var e=(n.doc.dataset||[]).slice(1);n.preview=t.parse(n.doc.template,n.doc.dataset,n.active),n.possibilities=_.uniq(_.map(e,function(t){return t[0]||null}))},!0)}}}]),angular.module("liquidoc").directive("docEditor",function(){return{restrict:"A",templateUrl:"app/components/doc-editor/doc-editor.html",scope:{docEditor:"="},link:function(t,n){function e(n,e){if(document.selection)n.focus(),sel=document.selection.createRange(),sel.text=e;else if(n.selectionStart||"0"==n.selectionStart){var o=n.selectionStart,a=n.selectionEnd;n.value=n.value.substring(0,o)+e+n.value.substring(a,n.value.length)}else n.value+=e;t.doc.template=n.value}t.doc=t.docEditor,t.conditionCollapse=!0,t.doc.template="",t.newCondition={},t.buttons=["test"];var o=null;t.save=function(t){null===o?Fledit.create(t).once("complete",function(t){o=t,console.log(t.link()),console.log(t.admin())}):(o.content=t,o.save())},t.parseCsv=function(n){console.log(n);var e,o=[];e=n.split("\n");for(var a=0;a<e.length;a++)o.push(e[a].split("	"));t.doc.dataset=o,t.buttons=[];for(var a=1;a<o[0].length;a++){var i=o[0][a];-1===t.buttons.indexOf(i)&&t.buttons.push(i)}console.log(t.doc.dataset)},t.insertVar=function(t){var o=n.find("textarea.form-template");e(o.get(0),"{{"+t+"}}")},t.insertCondition=function(){console.log(t.newCondition);var o=t.newCondition.type?t.newCondition.type:"=",a="IF "+t.newCondition["var"]+" "+o+" "+t.newCondition.value+' THEN "'+t.newCondition.then+'" ELSE "'+t.newCondition.other+'"',i=n.find("textarea.form-template");e(i.get(0),"{{"+a+"}}")}}}}),angular.module("liquidoc").controller("MainCtrl",["$scope",function(t){t.doc={}}]),angular.module("liquidoc").run(["$templateCache",function(t){t.put("app/components/doc-editor/doc-editor.html",'<form ng-submit="save(doc)"><tabset ng-show="doc.dataset"><tab heading="Add variables"><p><span ng-repeat="button in buttons"><button class="btn btn-default btn-sm" ng-click="insertVar(button)"><span class="glyphicon glyphicon-plus"></span> <span ng-bind="button"></span></button></span></p></tab><tab heading="Add conditions"><p><strong><span class="glyphicon glyphicon-cog"></span> The condition</strong></p><div class="well"><strong class="shift-right" style="font-size:1.2em">If</strong><select style="display:inline-block;width:150px" class="form-control shift-right" ng-model="newCondition.var" ng-options="button for button in buttons"><option value="">Select</option></select><select style="display:inline-block;width:150px" class="form-control shift-right" ng-model="newCondition.type"><option value="">equal to</option><option value="<">smaller then</option><option value=">">greater then</option></select><input style="display:inline-block;width:150px" class="form-control" ng-model="newCondition.value"></div><p><strong><span class="glyphicon glyphicon-align-left"></span> Then show this text</strong></p><p><input class="form-control" ng-model="newCondition.then"></p><p><strong><span class="glyphicon glyphicon-align-left"></span> Else show this text</strong></p><p><input class="form-control" ng-model="newCondition.other"></p><p><button class="btn btn-default" ng-click="insertCondition()"><span class="glyphicon glyphicon-plus"></span> Add condition</button></p></tab></tabset><h3>Your template</h3><textarea ng-model="doc.template" placeholder="Your template here" class="form-control form-template"></textarea><h3>Your dataset</h3><p><textarea ng-model="dataset" ng-change="parseCsv(dataset)" placeholder="Your dataset here" class="form-control form-csv"></textarea></p><div class="text-right"><button type="submit" class="btn btn-primary btn-lg">Save</button></div><br class="clearfix"></form>'),t.put("app/components/doc-viewer/doc-viewer.html",'<select ng-options="value for value in possibilities" ng-model="active" class="form-control" style="display:inline-block; width:auto;" ng-disabled="!doc.dataset"><option value="">Pick a value</option></select><div class="main__viewer__body"><div btf-markdown="preview"></div></div>'),t.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse" ng-controller="NavbarCtrl"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="https://github.com/jplusplus/liquidoc">Liquidoc</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"></ul></div></div></nav>')}]);